select sum(tb1.checkin_mile)/sum(tb1.checkin_s_mile)
from hdb.recent_flights_cost tb1
left join(

select distinct route_name
from(
select segment_head_id,flights_id,flag,route_name,route_id,h_route_id,segment_Type
from(
select t1.segment_head_id,t1.flights_id,t1.flag,t1.route_name,t1.route_id,t1.h_route_id,t1.segment_Type
 from dw.da_flight t1
 left join dw.dim_segment_type t2 on t1.route_id=t2.route_id and t1.h_route_id=t2.h_route_id
 where t1.flight_date>=to_date('2019-07-01','yyyy-mm-dd')
   and t1.flight_date< to_date('2020-07-01','yyyy-mm-dd')
   and t1.destairport in('LYG',
'XFN',
'CIF',
'LZO',
'DLU',
'AKU',
'YNJ',
'WMT',
'HTN',
'LZH',
'LYA',
'WDS',
'HSN',
'JNG',
'YIN',
'ENH',
'ACX',
'HYN',
'TCZ',
'DAT',
'BSD',
'BFJ',
'NNY',
'WXN',
'TGO',
'CGD',
'HNY',
'XIC',
'MDG',
'RIZ',
'NAO',
'YBP',
'HDG',
'TEN',
'FUG',
'DNH',
'DOY',
'FUO',
'JGS',
'TXN',
'KRY',
'CIH',
'DQA',
'HLH',
'JMU',
'YIC',
'LFQ',
'XIL',
'XAI',
'ENY',
'MXZ',
'HZG',
'WUS',
'SYM',
'DIG',
'HJJ',
'AQG',
'JDZ',
'JGN',
'DAX',
'BAR',
'LZY',
'YYA',
'PZI',
'JUH',
'WUA',
'NBS',
'BPE',
'TVS',
'SQD',
'AAT',
'JIQ',
'GYS',
'IQN',
'WUT',
'LNJ',
'WEF',
'LLV',
'JMJ',
'NDG',
'RLK',
'KCA',
'CDE',
'YKH',
'JUZ',
'WGN',
'JNZ',
'GYU',
'NZH',
'BPX',
'ZAT',
'AVA',
'TLQ',
'TCG',
'CWJ',
'LPF',
'QSZ',
'YUS',
'ZQZ',
'BPL',
'HMI',
'LNL',
'JXA',
'ZHY',
'DDG',
'SQJ',
'ERL',
'LCX',
'GOQ',
'WUZ',
'DCY',
'AEB',
'HEK',
'NLH',
'YZY',
'THQ',
'BZX',
'JIC',
'JGD',
'AOG',
'WNS',
'UCB',
'KJI',
'TWC',
'LDS',
'CHG',
'AXF',
'RKZ',
'LLB',
'YSQ',
'TNH',
'NZL',
'IQM',
'GMQ',
'RQA',
'JSJ',
'NLT',
'HXD',
'YIE',
'KJH',
'NGQ',
'GXH',
'OHE',
'HUO',
'HTT',
'XYI',
'LLF',
'DBC',
'FYN',
'DTU',
'GZG',
'FYJ',
'SHF',
'HPG',
'AHJ',
'HBQ',
'EJN',
'HCJ',
'JZH',
'HZH',
'RHT',
'WSK',
'GZG',
'CNI',
'AKA')

union 


select t1.segment_head_id,t1.flights_id,t1.flag,t1.route_name,t1.route_id,t1.h_route_id,t1.segment_Type
 from dw.da_flight t1
 left join dw.dim_segment_type t2 on t1.route_id=t2.route_id and t1.h_route_id=t2.h_route_id
 where t1.flight_date>=to_date('2019-07-01','yyyy-mm-dd')
   and t1.flight_date< to_date('2020-07-01','yyyy-mm-dd')
and t1.originairport in('LYG',
'XFN',
'CIF',
'LZO',
'DLU',
'AKU',
'YNJ',
'WMT',
'HTN',
'LZH',
'LYA',
'WDS',
'HSN',
'JNG',
'YIN',
'ENH',
'ACX',
'HYN',
'TCZ',
'DAT',
'BSD',
'BFJ',
'NNY',
'WXN',
'TGO',
'CGD',
'HNY',
'XIC',
'MDG',
'RIZ',
'NAO',
'YBP',
'HDG',
'TEN',
'FUG',
'DNH',
'DOY',
'FUO',
'JGS',
'TXN',
'KRY',
'CIH',
'DQA',
'HLH',
'JMU',
'YIC',
'LFQ',
'XIL',
'XAI',
'ENY',
'MXZ',
'HZG',
'WUS',
'SYM',
'DIG',
'HJJ',
'AQG',
'JDZ',
'JGN',
'DAX',
'BAR',
'LZY',
'YYA',
'PZI',
'JUH',
'WUA',
'NBS',
'BPE',
'TVS',
'SQD',
'AAT',
'JIQ',
'GYS',
'IQN',
'WUT',
'LNJ',
'WEF',
'LLV',
'JMJ',
'NDG',
'RLK',
'KCA',
'CDE',
'YKH',
'JUZ',
'WGN',
'JNZ',
'GYU',
'NZH',
'BPX',
'ZAT',
'AVA',
'TLQ',
'TCG',
'CWJ',
'LPF',
'QSZ',
'YUS',
'ZQZ',
'BPL',
'HMI',
'LNL',
'JXA',
'ZHY',
'DDG',
'SQJ',
'ERL',
'LCX',
'GOQ',
'WUZ',
'DCY',
'AEB',
'HEK',
'NLH',
'YZY',
'THQ',
'BZX',
'JIC',
'JGD',
'AOG',
'WNS',
'UCB',
'KJI',
'TWC',
'LDS',
'CHG',
'AXF',
'RKZ',
'LLB',
'YSQ',
'TNH',
'NZL',
'IQM',
'GMQ',
'RQA',
'JSJ',
'NLT',
'HXD',
'YIE',
'KJH',
'NGQ',
'GXH',
'OHE',
'HUO',
'HTT',
'XYI',
'LLF',
'DBC',
'FYN',
'DTU',
'GZG',
'FYJ',
'SHF',
'HPG',
'AHJ',
'HBQ',
'EJN',
'HCJ',
'JZH',
'HZH',
'RHT',
'WSK',
'GZG',
'CNI',
'AKA')


union 


select t1.segment_head_id,t1.flights_id,t1.flag,t1.route_name,t1.route_id,t1.h_route_id,t1.segment_Type
 from dw.da_flight t1
 left join dw.dim_segment_type t2 on t1.route_id=t2.route_id and t1.h_route_id=t2.h_route_id
 where t1.flight_date>=to_date('2019-07-01','yyyy-mm-dd')
   and t1.flight_date< to_date('2020-07-01','yyyy-mm-dd')
and t1.mid_airport in('LYG',
'XFN',
'CIF',
'LZO',
'DLU',
'AKU',
'YNJ',
'WMT',
'HTN',
'LZH',
'LYA',
'WDS',
'HSN',
'JNG',
'YIN',
'ENH',
'ACX',
'HYN',
'TCZ',
'DAT',
'BSD',
'BFJ',
'NNY',
'WXN',
'TGO',
'CGD',
'HNY',
'XIC',
'MDG',
'RIZ',
'NAO',
'YBP',
'HDG',
'TEN',
'FUG',
'DNH',
'DOY',
'FUO',
'JGS',
'TXN',
'KRY',
'CIH',
'DQA',
'HLH',
'JMU',
'YIC',
'LFQ',
'XIL',
'XAI',
'ENY',
'MXZ',
'HZG',
'WUS',
'SYM',
'DIG',
'HJJ',
'AQG',
'JDZ',
'JGN',
'DAX',
'BAR',
'LZY',
'YYA',
'PZI',
'JUH',
'WUA',
'NBS',
'BPE',
'TVS',
'SQD',
'AAT',
'JIQ',
'GYS',
'IQN',
'WUT',
'LNJ',
'WEF',
'LLV',
'JMJ',
'NDG',
'RLK',
'KCA',
'CDE',
'YKH',
'JUZ',
'WGN',
'JNZ',
'GYU',
'NZH',
'BPX',
'ZAT',
'AVA',
'TLQ',
'TCG',
'CWJ',
'LPF',
'QSZ',
'YUS',
'ZQZ',
'BPL',
'HMI',
'LNL',
'JXA',
'ZHY',
'DDG',
'SQJ',
'ERL',
'LCX',
'GOQ',
'WUZ',
'DCY',
'AEB',
'HEK',
'NLH',
'YZY',
'THQ',
'BZX',
'JIC',
'JGD',
'AOG',
'WNS',
'UCB',
'KJI',
'TWC',
'LDS',
'CHG',
'AXF',
'RKZ',
'LLB',
'YSQ',
'TNH',
'NZL',
'IQM',
'GMQ',
'RQA',
'JSJ',
'NLT',
'HXD',
'YIE',
'KJH',
'NGQ',
'GXH',
'OHE',
'HUO',
'HTT',
'XYI',
'LLF',
'DBC',
'FYN',
'DTU',
'GZG',
'FYJ',
'SHF',
'HPG',
'AHJ',
'HBQ',
'EJN',
'HCJ',
'JZH',
'HZH',
'RHT',
'WSK',
'GZG',
'CNI',
'AKA')
))hh1)tb2 on tb1.route_name=tb2.route_name
where tb1.flight_date>=to_date('2019-07-01','yyyy-mm-dd')
  and tb1.flight_date< to_date('2020-07-01','yyyy-mm-dd')
  and tb1.total_cost>0
  and tb1.checkin_s_mile>0
  and tb1.checkin_mile>0
